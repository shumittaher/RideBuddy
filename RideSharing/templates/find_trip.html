{% extends "layout.html" %}

{% block body %}

<section class="text-center">

    <form action="" method="post" style="max-width: 700px;" class="mx-auto">

        {{ search_form }}

    </form>

</section>

<section id="search_results" class="mt-5"> 

    {% include 'component_snippets/trips_list.html' with trips=all_trips %}

</section>

<script>

    document.addEventListener('DOMContentLoaded', ()=>{

        const search_form_area = document.getElementById('location-area-searchbox')
        search_form_area.addEventListener('change', handle_searcharea_change)

    })

    function handle_searcharea_change() {
        fetch_trips()
    }

    async function fetch_trips(){

        const response = await fetch('give_trips')
        if (response.ok) {
            const updatedTrips = await response.json();
            updateTripsList(updatedTrips.rendered_trips); 
        } else {
            console.error('Failed to fetch trips:', response.statusText);
        }

    }

    function updateTripsList(trips) {

        const searchResults = document.getElementById('search_results');
        searchResults.innerHTML = trips
   
    }

</script>
{% endblock %}