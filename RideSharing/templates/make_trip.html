{% extends "layout.html" %}

{% block body %}


<div class="text-center">

    <form action="{% url 'make_trip' %}" method="post" style="max-width: 700px;" class="mx-auto">

        {% csrf_token %}

        {{trip_form}}
        
        <input class="mt-1 btn btn-primary" type="submit">
    
    </form>

</div>

<div class="mt-5">

    {% for trip in my_active_trips %}
    <div class="border shadow boxes rounded w-100 mx-auto d-flex justify-content-center align-items-center">

        <div class="">
            <div class="border-primary-subtle open_seats_container d-flex justify-content-center align-items-center">
                <div>
                    {{trip.open_seats}}
                </div>
            </div>
        </div>
        <div class=" flex-fill px-4">
            <div class=" d-flex justify-content-between border-bottom border-primary-subtle border-2">
                <div>
                    <h4>
                        {{trip.origin.location_name}}
                    </h4>
                    <h6>
                        {{trip.origin.location_area}}
                    </h6>
                </div>
                <div>
                    <h4>
                        {{trip.destination.location_name}}
                    </h4>
                    <h6>
                        {{trip.destination.location_area}}
                    </h6>
                </div>
            </div>
            <div class="mt-1">
               <h6>
                    Departure Time: {{trip.departure_time}}
               </h6>
            </div>
        </div>
    </div>
    {% endfor %}
    
</div>

<script>

    document.addEventListener('DOMContentLoaded', ()=>{

        const valid_for = document.getElementById('id_valid_for')
        const valid_till = document.getElementById('id_valid_till')

        const currentDate = new Date()

        valid_for.addEventListener('change', update_valid_date)
        
        function update_valid_date() {
            
            let targetDate = new Date()

            switch (valid_for.value) {

            case 'monthly':
                targetDate.setMonth(currentDate.getMonth() + 1);
                break;
            case 'quarterly':
                targetDate.setMonth(currentDate.getMonth() + 3);
                break;
            case 'semi_annually':
                targetDate.setMonth(currentDate.getMonth() + 6);
                break;
            case 'annually':
                targetDate.setFullYear(currentDate.getFullYear() + 1);
                break;
            }

            valid_till.value = targetDate.toISOString().split('T')[0];
            valid_till.focus()
        }
        
    })

</script>

{% endblock %}